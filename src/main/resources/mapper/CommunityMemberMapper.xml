<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.xianzhiyun.mapper.CommunityMemberMapper">

    <insert id="insert" parameterType="com.example.xianzhiyun.entity.CommunityMember">
        INSERT INTO community_member (community_id, user_id, role, join_time)
        VALUES (#{communityId}, #{userId}, #{role}, #{joinTime})
    </insert>

    <delete id="delete" parameterType="map">
        DELETE FROM community_member WHERE community_id = #{communityId} AND user_id = #{userId}
    </delete>

    <!-- 保留这个 exists 定义 -->
    <select id="exists" resultType="int" parameterType="map">
        SELECT COUNT(1) FROM community_member WHERE community_id = #{communityId} AND user_id = #{userId}
    </select>

    <select id="countByCommunityId" resultType="int">
        SELECT COUNT(1) FROM community_member WHERE community_id = #{communityId}
    </select>

    <select id="selectUserIdsByCommunity" resultType="long" parameterType="map">
        SELECT user_id FROM community_member
        WHERE community_id = #{communityId}
        ORDER BY join_time DESC
            LIMIT #{limit}
    </select>

    <select id="selectByCommunityAndUser" resultType="com.example.xianzhiyun.entity.CommunityMember">
        SELECT * FROM community_member
        WHERE community_id = #{communityId} AND user_id = #{userId}
    </select>

    <delete id="deleteByCommunityAndUser">
        DELETE FROM community_member
        WHERE community_id = #{communityId} AND user_id = #{userId}
    </delete>

    <!-- 已删除此处重复的 exists 代码块 -->

</mapper>